- name: Dump ALL keys and values from semaphore_vars individually
  ansible.builtin.debug:
    var: item
  with_dict: "{{ semaphore_vars }}"

- name: Dump all environment variables
  ansible.builtin.shell: env
  register: env_output

- name: Show all ENV variables
  ansible.builtin.debug:
    var: env_output.stdout_lines
    
- name: Clone repo with Dockerfile
  ansible.builtin.git:
    repo: 'https://github.com/frankja2/nodejs-demoapp.git'
    dest: '/tmp/dockerfile-repo'
    version: main

- name: Build docker image
  become: true
  shell: docker build -t 10.0.0.215:5000/nodejs-demoapp:{{ semaphore_vars.task_details.target_version }} /tmp/dockerfile-repo

- name: Push docker image
  become: true
  shell: docker push 10.0.0.215:5000/nodejs-demoapp:{{ semaphore_vars.task_details.target_version }}

